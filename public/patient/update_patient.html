<!DOCTYPE html>
<html>

<head>
    <title>HOSPITAL MANAGEMENT</title>
    <link href="../picture/bku.png" rel="icon" type="image/x-icon">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>

    <div style="margin-bottom: 42px;">
        <header class="logo-name">
            <ul style="list-style: none;">
                <li style="float: left;margin-left: 130px;padding-right:30px;"><img src="../picture/bku.png"
                        alt="bkupic" height="80px"></li>
                <li>
                    <h1
                        style="font-family: Arial, Helvetica, sans-serif;font-size: 22pt;padding-top: 28px;padding-left: 200px;">
                        <i>BK Hospital</i>
                    </h1>
                </li>
            </ul>
        </header>
    </div>

    <div class="functab" style="background-color: #3AB0FF;padding-top: 7px;padding-bottom: 7px;">
        <ul style="list-style: none;">
            <li style="float: left;padding-right: 350px;padding-left: 120px;"><a href="../FirstPage/firstpage.html"
                    rel=""><b>HOME</b></a></li>
            <li style="float: left;"><a href="../patient/patient_inf.html" rel=""><b>BỆNH NHÂN</b></a></li>
            <li style="float: left;"><a href="../hopitalstaff/h_staff.html" rel=""><b>NHÂN VIÊN Y TẾ</b></a></li>
            <li style="float: left;"><a href="../medicine/medicine.html" rel=""><b>THUỐC</b></a></li>
            <li style="float: left ;padding-right: 50px;"><a href="../hospital-Machine/h_machine.html" rel=""><b>THIẾT
                        BỊ Y TẾ</b></a></li>
            <li><a id="loginbutt" rel=""><b><i>ADMIN</i></b></a></li>
        </ul>
    </div>

    <div class="sth" style="height: 780px;">
        <div id="query_update_box">
            <h3 id="here"></h3>
        </div>
        <div class="respon_update_box">
            <div style="display: block;padding: 20px 20px;width: 100%;background-color: #e7e7e7;">
                <h3 style="font-family: Arial, Helvetica, sans-serif;margin-left: 70px;"><b>CHỈNH SỬA THÔNG TIN BỆNH
                        NHÂN</b></h3>
                <hr color="#3AB0FF">
                <div style="padding-left: 100px;">
                    <label>
                        Tên bệnh nhân *
                        <input type="text" id="pa_name" value="" disabled><br><br>
                    </label>
                    <label>
                        Mã BHXH *
                        <input type="text" id="pa_bhxh" value="" disabled><br><br>
                    </label>
                    <label>
                        Mã Số CCCD *
                        <input type="text" id="pa_cccd" value="" disabled><br><br>
                    </label>
                    <label>
                        Số Điện thoại *
                        <input type="text" id="pa_number" placeholder="Để trống nếu không đổi"><br><br>
                    </label>
                    <label>
                        Địa chỉ *
                        <input type="text" id="pa_address" placeholder="Để trống nếu không đổi" size="45"><br><br>
                    </label>
                    <label>
                        Lịch sử bệnh án <label style="color: red;">*</label>
                        <input type="text" id="adddiachi" placeholder="Nếu không có, để trống." size="30"
                            autocomplete="off"><br><br>
                    </label>
                    <label>
                        Tình trạng <label style="color: red;">*</label>
                        <select id="status">
                            <option value="Tình trạng" hidden>Tình trạng</option>
                            <option value="Đang điều trị">Đang điều trị</option>
                            <option value="Đã khỏi">Đã khỏi</option>
                        </select><br><br>
                    </label>
                    <label>
                        Ngày khám <label style="color: red;">*</label>
                        <input type="date" id="datein" autocomplete="off" value=""><br><br>
                    </label>
                    <label>
                        Ngày tái khám <label style="color: red;">*</label>
                        <input type="date" id="dateout" autocomplete="off"><br><br>
                    </label>
                    <label>
                        Kết quả xét nghiệm *<br>
                        <textarea id="pa_kqxn" rows="8" cols="100"></textarea><br><br>
                    </label>
                </div>

                <button id="completeupdate"
                    style="border: none;padding: 10px 20px;border-radius: 7px;color: white;background-color: #3AB0FF;margin: 20px 400px;">Cập
                    nhật thay đổi</button>
            </div>
        </div>
    </div>

    <div class="footer_page" style="height: 200px;background-color: #76c2f5;">
        <h3 style="font-family: Arial, Helvetica, sans-serif;text-align: center;margin-top: 20px;padding-top: 20px;">
            <i>&copy 2024 - This is product of "5 AE Siu Nhơn"</i>
        </h3>
        <nav style="width: 50%;float: left;">
            <address style="margin-left: 10%;">
                Contact us: tenmarkornever@yahoo.com<br>
                Number: (+84) 123456789<br>
                Head officer: Bach Khoa University, Ho Chi Minh City, VietNam
            </address>
        </nav>
        <nav style="width: 50%;float: left;">

        </nav>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
        import { getDatabase, ref, get, set, update, push, remove } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

        // const firebaseConfig = {
        //     apiKey: "AIzaSyDcB0lhFB7D-vW3fls9DNLQKcQPHkngvn4",
        //     authDomain: "hopital-test.firebaseapp.com",
        //     databaseURL: "https://hopital-test-default-rtdb.firebaseio.com",
        //     projectId: "hopital-test",
        //     storageBucket: "hopital-test.appspot.com",
        //     messagingSenderId: "208649174671",
        //     appId: "1:208649174671:web:58f13bcbc5e89523c1bafa"
        // };

        // const firebaseConfig = {
        //     apiKey: "AIzaSyAAFM2lteHzd_CJCzF_fOSNrRgk2IBHmuE",
        //     authDomain: "rebuild-10fed.firebaseapp.com",
        //     projectId: "rebuild-10fed",
        //     storageBucket: "rebuild-10fed.appspot.com",
        //     messagingSenderId: "434656807599",
        //     appId: "1:434656807599:web:93e221777958e18bbe225a"
        // };

        const firebaseConfig = {
            apiKey: "AIzaSyDmkmTyzd5AN6fntdPITejCGtl9PeIPyAc",
            authDomain: "nonetest-ef5ff.firebaseapp.com",
            projectId: "nonetest-ef5ff",
            storageBucket: "nonetest-ef5ff.appspot.com",
            messagingSenderId: "879700616489",
            appId: "1:879700616489:web:dbb66ab44f8226f82b0338"
        };

        let app = initializeApp(firebaseConfig);
        let db = getDatabase();

        // Function to check if the patient with the given cccd exists in the database

        function checkUpdatePatient(cccd) {
            //update patient information with cccd finding in database
            /*
            set(ref(db, `PatientSet/${patientCCCD}`), {
                a_patientName: patientName,
                b_BHXH: patientBHXH,
                c_CCCD: patientCCCD,
                d_phone: patientSDT,
                e_gender: patientGender,
                f_address: patientAddress,
                g_kqxn: patientKQXN,
                h_status: patientstatus,
                i_history: patientHistory,
                j_datein: patientDateIn,
                k_dateout: patientDateOut
            });
            */
            /*Update the patient information in the database,the fields that are empty will not be updated
                Example only the phone number is not null then only update the phone number
            */
            // Update the patient information in the database, the fields that are empty will not be updated
            const patientCCCD = document.getElementById('pa_cccd').value;
            const patientSDT = document.getElementById('pa_number').value;
            const patientAddress = document.getElementById('pa_address').value;
            const patientHistory = document.getElementById('adddiachi').value;
            const patientStatus = document.getElementById('status').value;
            const patientDateIn = document.getElementById('datein').value;
            const patientDateOut = document.getElementById('dateout').value;
            const patientKQXN = document.getElementById('pa_kqxn').value;

            if (patientSDT !== '') {
                update(ref(db, `PatientSet/${patientCCCD}`), {
                    d_phone: patientSDT
                }).catch((error) => {
                    console.error("Error updating document: ", error);
                });
            }

            if (patientAddress !== '') {
                update(ref(db, `PatientSet/${patientCCCD}`), {
                    f_address: patientAddress
                }).catch((error) => {
                    console.error("Error updating document: ", error);
                });
            }

            if (patientHistory !== '') {
                update(ref(db, `PatientSet/${patientCCCD}`), {
                    i_history: patientHistory
                }).catch((error) => {
                    console.error("Error updating document: ", error);
                });
            }

            if (patientStatus !== 'Tình trạng') {
                update(ref(db, `PatientSet/${patientCCCD}`), {
                    h_status: patientStatus
                }).catch((error) => {
                    console.error("Error updating document: ", error);
                });
            }

            if (patientDateIn !== '') {
                update(ref(db, `PatientSet/${patientCCCD}`), {
                    j_datein: patientDateIn
                }).catch((error) => {
                    console.error("Error updating document: ", error);
                });
            }

            if (patientDateOut !== '') {
                update(ref(db, `PatientSet/${patientCCCD}`), {
                    k_dateout: patientDateOut
                }).catch((error) => {
                    console.error("Error updating document: ", error);
                });
            }

            if (patientKQXN !== '') {
                update(ref(db, `PatientSet/${patientCCCD}`), {
                    g_kqxn: patientKQXN
                }).catch((error) => {
                    console.error("Error updating document: ", error);
                });
            }
            alert("Cập nhật thông tin bệnh nhân thành công!");
            setTimeout(() => {
                window.location.href = '../patient/patient_inf.html';
            }, 2000);
        }

        document.getElementById('completeupdate').addEventListener('click', () => {
            const patientCCCD = document.getElementById('pa_cccd').value;
            checkUpdatePatient(patientCCCD);
        });
    </script>

    <script>
        // Wait for the DOM content to be fully loaded
        document.addEventListener("DOMContentLoaded", function () {
            // Retrieve the values of s_patientName, s_bhxh, and s_cccd from the URL query string
            const urlParams = new URLSearchParams(window.location.search);
            const s_patientName = urlParams.get('s_patientName');
            const s_bhxh = urlParams.get('s_bhxh');
            const s_cccd = urlParams.get('s_cccd');

            document.getElementById('pa_name').value = s_patientName;
            document.getElementById('pa_bhxh').value = s_bhxh;
            document.getElementById('pa_cccd').value = s_cccd;
            //call function to check update patient information with cccd
        });

        //return to the patient_inf.html if click the button "Cập nhật thay đổi"
        // document.getElementById('completeupdate').addEventListener('click', () => {
        //     window.location.href = '../patient/patient_inf.html';
        // });
    </script>
</body>

</html>

<style>
    /* Responsive layout - makes the menu and the content (inside the section) sit on top of each other instead of next to each other */
    @media (max-width: 600px) {
        section {
            -webkit-flex-direction: column;
            flex-direction: column;
        }
    }

    body {
        background-image: url("../picture/4.png");
    }

    a,
    a:active,
    a:visited {
        color: rgb(0, 0, 0);
        text-decoration: none;
        font-family: Verdana, Geneva, Tahoma, sans-serif;
        font: bold;
        padding: 20px;
    }

    a:hover {
        background-color: #1a9ef6;
    }

    #loginbutt {
        padding: 20px;
        border-radius: 16px;
        background-color: #FFFF;
    }

    #loginbutt:hover {
        background-color: #0066ff;
    }

    .sth {
        font-size: larger;
    }
</style>